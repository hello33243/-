<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²‰å«©ç³»ç‡Ÿæ¥­é¡è¿½è¹¤ - å°ˆæ¥­ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --soft-pink: #ffb7c5;
            --accent-pink: #f8a5c2;
            --deep-base: #1a1617;
            --card-bg: rgba(45, 38, 40, 0.6);
        }
        body {
            background-color: var(--deep-base);
            color: #fceef0;
            font-family: "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif;
            background-image: radial-gradient(circle at 50% -20%, #3d2b30 0%, #1a1617 100%);
            min-height: 100vh;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }
        .pink-glow {
            text-shadow: 0 0 15px rgba(255, 183, 197, 0.4);
        }
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 183, 197, 0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card:hover {
            border-color: var(--soft-pink);
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 183, 197, 0.15);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* AI Loading Animation */
        .typing-loader {
            display: inline-block;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: var(--soft-pink);
            box-shadow: 10px 0 var(--soft-pink), -10px 0 var(--soft-pink);
            animation: typing 1s infinite linear;
            margin-left: 15px;
        }
        @keyframes typing {
            0% { background-color: var(--soft-pink); }
            33% { background-color: rgba(255,183,197, 0.3); }
            66% { background-color: rgba(255,183,197, 0.1); }
        }
        .progress-fill {
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        }
    </style>
</head>
<body class="p-4 md:p-10">
    <div class="max-w-6xl mx-auto">
        <!-- æ¨™é¡Œå€ -->
        <header class="mb-12 text-center">
            <h1 class="text-5xl md:text-6xl font-black tracking-tighter text-pink-200 pink-glow mb-4">Sales Diary Plus</h1>
            <p class="text-pink-300 opacity-50 uppercase tracking-[0.4em] text-xs font-bold">Smart Business Monitoring Center</p>
        </header>

        <!-- æ•¸æ“šæ ¸å¿ƒæŒ‡æ¨™ -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
            <div class="card rounded-[2rem] p-6 text-center">
                <p class="text-pink-200 opacity-60 text-[10px] font-black mb-3 tracking-widest uppercase">Base Target åŸºç¤ç›®æ¨™</p>
                <div class="flex items-center justify-center gap-1">
                    <span class="text-xl font-light text-pink-300">$</span>
                    <input type="number" id="targetInput" class="bg-transparent text-2xl font-bold text-white w-32 text-center border-b border-pink-200 border-opacity-10 focus:border-opacity-100 transition-all outline-none">
                </div>
            </div>
            <div class="card rounded-[2rem] p-6 text-center border-pink-400/20">
                <p class="text-pink-200 opacity-60 text-[10px] font-black mb-3 tracking-widest uppercase">Challenge Target æŒ‘æˆ°ç›®æ¨™</p>
                <div class="flex items-center justify-center gap-1">
                    <span class="text-xl font-light text-pink-300">$</span>
                    <input type="number" id="target2Input" class="bg-transparent text-2xl font-bold text-white w-32 text-center border-b border-pink-200 border-opacity-10 focus:border-opacity-100 transition-all outline-none">
                </div>
            </div>
            <div class="card rounded-[2rem] p-6 text-center bg-gradient-to-b from-pink-500/10 to-transparent">
                <p class="text-pink-200 opacity-60 text-[10px] font-black mb-3 tracking-widest uppercase">Total Accumulation ç›®å‰ç´¯ç©</p>
                <p class="text-3xl font-black text-white" id="totalDisplay">$0</p>
            </div>
            <div class="card rounded-[2rem] p-6 text-center">
                <p class="text-pink-200 opacity-60 text-[10px] font-black mb-3 tracking-widest uppercase">Gap to Challenge å‰©é¤˜å·®é¡</p>
                <p class="text-2xl font-bold text-pink-200" id="gapDisplay">$0</p>
            </div>
        </div>

        <!-- é€²åº¦æ¢è¦–è¦ºåŒ– -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <div class="card rounded-3xl p-6">
                <div class="flex justify-between items-end mb-4">
                    <span class="text-xs font-bold text-pink-200 opacity-70 uppercase tracking-widest">åŸºç¤é€²åº¦</span>
                    <span id="percentDisplay" class="text-2xl font-black text-pink-200">0%</span>
                </div>
                <div class="h-3 w-full bg-white/5 rounded-full overflow-hidden">
                    <div id="progressBar" class="progress-fill h-full bg-pink-300 shadow-[0_0_15px_rgba(255,183,197,0.5)]" style="width: 0%"></div>
                </div>
            </div>
            <div class="card rounded-3xl p-6 border-pink-400/30">
                <div class="flex justify-between items-end mb-4">
                    <span class="text-xs font-bold text-pink-200 opacity-70 uppercase tracking-widest">æŒ‘æˆ°é€²åº¦</span>
                    <span id="percentDisplay2" class="text-2xl font-black text-pink-400">0%</span>
                </div>
                <div class="h-3 w-full bg-white/5 rounded-full overflow-hidden">
                    <div id="progressBar2" class="progress-fill h-full bg-gradient-to-r from-pink-300 to-pink-500 shadow-[0_0_20px_rgba(248,165,194,0.4)]" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- AI åˆ†æäº’å‹•å€ -->
        <div class="card rounded-[2.5rem] p-8 mb-12 border-pink-400/40 bg-gradient-to-br from-pink-900/30 via-transparent to-transparent">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="flex items-center gap-5">
                    <div class="w-14 h-14 bg-pink-400/20 rounded-2xl flex items-center justify-center text-3xl shadow-inner">âœ¨</div>
                    <div>
                        <h3 class="font-bold text-xl text-pink-100">Gemini æ™ºæ…§ç‡Ÿé‹åŠ©æ‰‹</h3>
                        <p class="text-sm text-pink-300/60 font-medium">åŸºæ–¼ç•¶å‰æ•¸æ“šç”Ÿæˆå‹•æ…‹å»ºè­°èˆ‡èªéŸ³ç°¡å ±</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button id="aiVoiceBtn" onclick="runAI(true)" class="group bg-white/5 hover:bg-white/10 border border-pink-200/20 text-pink-200 px-6 py-3 rounded-2xl text-sm font-bold transition-all flex items-center gap-2">
                        <span class="group-hover:scale-110 transition-transform">ğŸ”Š</span> èªéŸ³æ‘˜è¦
                    </button>
                    <button id="aiAnalysisBtn" onclick="runAI(false)" class="group bg-pink-300 hover:bg-pink-200 text-gray-900 px-8 py-3 rounded-2xl text-sm font-black transition-all shadow-xl shadow-pink-500/30 flex items-center gap-2">
                        <span class="group-hover:rotate-12 transition-transform">âœ¨</span> æ™ºæ…§åˆ†æå»ºè­°
                    </button>
                </div>
            </div>
            <div id="aiResponseArea" class="mt-6 hidden animate-in fade-in slide-in-from-top-2 duration-500 text-base text-pink-50/90 leading-relaxed bg-black/30 p-6 rounded-3xl border border-white/5">
                <div id="aiContent" class="whitespace-pre-line"></div>
                <div id="aiLoader" class="py-2 hidden"><span class="typing-loader"></span></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            <!-- æ•¸æ“šè¼¸å…¥ -->
            <section>
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-6 bg-pink-300 rounded-full shadow-[0_0_12px_rgba(255,183,197,0.8)]"></div>
                    <h2 class="text-xl font-bold tracking-tight">æ–°å¢æ¯æ—¥æ•¸æ“š</h2>
                </div>
                <div class="card rounded-[2rem] p-8">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-pink-200 opacity-50 text-[10px] font-black uppercase tracking-[0.2em] mb-3">é¸å–æ—¥æœŸ</label>
                            <input type="date" id="dateInput" class="w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-4 focus:border-pink-300/50 transition-all outline-none text-white font-medium">
                        </div>
                        <div>
                            <label class="block text-pink-200 opacity-50 text-[10px] font-black uppercase tracking-[0.2em] mb-3">è¼¸å…¥é‡‘é¡ (TWD)</label>
                            <input type="number" id="amountInput" placeholder="è«‹è¼¸å…¥ç‡Ÿæ¥­é¡æ•¸å­—" class="w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-4 focus:border-pink-300/50 transition-all outline-none text-white text-lg font-bold">
                        </div>
                        <button onclick="addRecord()" class="w-full bg-pink-300 hover:bg-pink-200 text-gray-900 font-black py-5 rounded-2xl transition-all shadow-lg shadow-pink-500/20 uppercase tracking-widest text-sm">
                            å„²å­˜ç•¶æ—¥æ•¸æ“šç´€éŒ„
                        </button>
                    </div>
                </div>
            </section>

            <!-- æ­·å²ç´€éŒ„ -->
            <section>
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-6 bg-pink-300 rounded-full shadow-[0_0_12px_rgba(255,183,197,0.8)]"></div>
                    <h2 class="text-xl font-bold tracking-tight">æ•¸æ“šæ­·å²æ¸…å–®</h2>
                </div>
                <div class="card rounded-[2rem] p-6 min-h-[400px] flex flex-col">
                    <div class="flex-grow overflow-y-auto max-h-[400px] custom-scrollbar pr-2">
                        <table class="w-full text-left">
                            <thead class="text-pink-200 opacity-40 text-[10px] font-black uppercase tracking-widest border-b border-white/10">
                                <tr>
                                    <th class="pb-4 pl-4">æ—¥æœŸ</th>
                                    <th class="pb-4">é‡‘é¡</th>
                                    <th class="pb-4 text-right pr-4">ç®¡ç†</th>
                                </tr>
                            </thead>
                            <tbody id="recordTable" class="text-sm"></tbody>
                        </table>
                        <div id="emptyState" class="py-24 text-center">
                            <p class="text-pink-200 opacity-20 italic text-sm tracking-widest uppercase">No Records Available</p>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-4 px-2">
                    <button onclick="clearAll()" class="text-[10px] font-bold text-pink-200 opacity-30 hover:opacity-100 hover:text-red-400 transition-all tracking-widest uppercase">
                        é‡è¨­æ•¸æ“šåº« Clear All
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        let salesData = JSON.parse(localStorage.getItem('salesData')) || [];
        let targetAmount = localStorage.getItem('salesTarget') || 1000000;
        let targetAmount2 = localStorage.getItem('salesTarget2') || 2000000;

        document.getElementById('dateInput').valueAsDate = new Date();
        document.getElementById('targetInput').value = targetAmount;
        document.getElementById('target2Input').value = targetAmount2;

        function updateUI() {
            const total = salesData.reduce((sum, item) => sum + item.amount, 0);
            const gap = Math.max(0, targetAmount2 - total);
            const p1 = targetAmount > 0 ? Math.min(100, (total / targetAmount * 100)) : 0;
            const p2 = targetAmount2 > 0 ? Math.min(100, (total / targetAmount2 * 100)) : 0;

            document.getElementById('totalDisplay').textContent = `$${total.toLocaleString()}`;
            document.getElementById('gapDisplay').textContent = `$${gap.toLocaleString()}`;
            document.getElementById('percentDisplay').textContent = `${p1.toFixed(1)}%`;
            document.getElementById('percentDisplay2').textContent = `${p2.toFixed(1)}%`;
            
            document.getElementById('progressBar').style.width = `${p1}%`;
            document.getElementById('progressBar2').style.width = `${p2}%`;

            const table = document.getElementById('recordTable');
            const emptyState = document.getElementById('emptyState');
            
            if (salesData.length === 0) {
                emptyState.style.display = 'block';
                table.innerHTML = '';
            } else {
                emptyState.style.display = 'none';
                table.innerHTML = salesData
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .map((item, index) => `
                        <tr class="border-b border-white/5 hover:bg-white/[0.03] transition-all group">
                            <td class="py-5 pl-4 text-white/70 font-mono">${item.date}</td>
                            <td class="py-5 font-bold text-pink-200">$${item.amount.toLocaleString()}</td>
                            <td class="py-5 text-right pr-4">
                                <button onclick="deleteRecord(${index})" class="w-8 h-8 rounded-full flex items-center justify-center ml-auto hover:bg-pink-500/20 text-pink-200 opacity-0 group-hover:opacity-100 transition-all">âœ•</button>
                            </td>
                        </tr>
                    `).join('');
            }

            localStorage.setItem('salesData', JSON.stringify(salesData));
            localStorage.setItem('salesTarget', targetAmount);
            localStorage.setItem('salesTarget2', targetAmount2);
        }

        async function runAI(isVoice) {
            const total = salesData.reduce((sum, item) => sum + item.amount, 0);
            const responseArea = document.getElementById('aiResponseArea');
            const contentArea = document.getElementById('aiContent');
            const loader = document.getElementById('aiLoader');

            responseArea.classList.remove('hidden');
            contentArea.textContent = "";
            loader.classList.remove('hidden');

            const prompt = `
                åº—é•·æ‚¨å¥½ï¼Œé€™æ˜¯ç›®å‰çš„åº—å…§ç¶“ç‡Ÿæ•¸æ“šæ‘˜è¦ï¼š
                - ç›®å‰ç´¯ç©ç‡Ÿæ¥­é¡ï¼š$${total} å…ƒ
                - æŒ‘æˆ°ç›®æ¨™é”æˆç‡ï¼š${((total/targetAmount2)*100).toFixed(1)}%
                - æ­·å²æˆäº¤ç­†æ•¸ï¼š${salesData.length} ç­†
                
                ${isVoice ? 'è«‹ç”¨å¤§ç´„ 100 å­—å¯«ä¸€æ®µè¦ªåˆ‡ã€å°ˆæ¥­ä¸”å…·æœ‰é¼“èˆæ€§çš„èªéŸ³å ±å‘Šè©ã€‚' : 'è«‹é‡å°ç›®å‰çš„æ•¸æ“šï¼Œæä¾› 3 å€‹é—œæ–¼æå‡å®¢å–®åƒ¹æˆ–ä¿ƒéŠ·æ´»å‹•çš„å°ˆæ¥­ç¹é«”ä¸­æ–‡ç‡Ÿé‹å»ºè­°ã€‚'}
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "æš«æ™‚ç„¡æ³•åˆ†ææ•¸æ“šï¼Œè«‹æª¢æŸ¥ API è¨­å®šã€‚";
                
                loader.classList.add('hidden');
                contentArea.textContent = text;
                
                if (isVoice) playVoice(text);
            } catch (error) {
                loader.classList.add('hidden');
                contentArea.textContent = "AI é€£çµå¤±æ•—ï¼Œè«‹ç¢ºä¿åœ¨æ”¯æ´ç’°å¢ƒä¸‹åŸ·è¡Œã€‚";
            }
        }

        async function playVoice(text) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `ç”¨æ¥µå…¶æº«æŸ”ä¸”å°ˆæ¥­çš„èªæ°£èªªï¼š${text}` }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } }
                        },
                        model: "gemini-2.5-flash-preview-tts"
                    })
                });

                const result = await response.json();
                const base64Data = result.candidates[0].content.parts[0].inlineData.data;
                const audioBlob = pcmToWav(base64Data, 24000);
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);
                audio.play();
            } catch (err) { console.error("Voice synthesis failed", err); }
        }

        function pcmToWav(base64, sampleRate) {
            const buffer = Uint8Array.from(atob(base64), c => c.charCodeAt(0)).buffer;
            const pcmData = new Int16Array(buffer);
            const wavBuffer = new ArrayBuffer(44 + pcmData.length * 2);
            const view = new DataView(wavBuffer);
            const writeString = (offset, s) => { for (let i = 0; i < s.length; i++) view.setUint8(offset + i, s.charCodeAt(i)); };
            writeString(0, 'RIFF');
            view.setUint32(4, 32 + pcmData.length * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, pcmData.length * 2, true);
            for (let i = 0; i < pcmData.length; i++) view.setInt16(44 + i * 2, pcmData[i], true);
            return new Blob([wavBuffer], { type: 'audio/wav' });
        }

        function addRecord() {
            const date = document.getElementById('dateInput').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            if (!date || isNaN(amount)) {
                alert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ—¥æœŸèˆ‡é‡‘é¡ã€‚");
                return;
            }
            salesData.push({ date, amount });
            document.getElementById('amountInput').value = '';
            updateUI();
        }

        function deleteRecord(index) {
            salesData.splice(index, 1);
            updateUI();
        }

        function clearAll() {
            if (confirm('ç¢ºå®šè¦æ°¸ä¹…æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚')) {
                salesData = [];
                updateUI();
            }
        }

        document.getElementById('targetInput').oninput = (e) => { targetAmount = parseFloat(e.target.value) || 0; updateUI(); };
        document.getElementById('target2Input').oninput = (e) => { targetAmount2 = parseFloat(e.target.value) || 0; updateUI(); };

        updateUI();
    </script>
</body>
</html>
