<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²‰å«©ç³»ç‡Ÿæ¥­é¡è¿½è¹¤ - ç¹é«”ä¸­æ–‡ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --soft-pink: #ffb7c5;
            --accent-pink: #f8a5c2;
            --deep-base: #1a1617;
            --card-bg: rgba(45, 38, 40, 0.6);
        }
        body {
            background-color: var(--deep-base);
            color: #fceef0;
            font-family: "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif;
            background-image: radial-gradient(circle at 50% -20%, #3d2b30 0%, #1a1617 100%);
            min-height: 100vh;
            margin: 0;
        }
        .pink-glow {
            text-shadow: 0 0 15px rgba(255, 183, 197, 0.4);
        }
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 183, 197, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card:hover {
            border-color: var(--soft-pink);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 183, 197, 0.1);
        }
        /* AI Loading Animation */
        .typing-loader {
            display: inline-block;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: var(--soft-pink);
            box-shadow: 10px 0 var(--soft-pink), -10px 0 var(--soft-pink);
            animation: typing 1s infinite linear;
            margin-left: 15px;
        }
        @keyframes typing {
            0% { background-color: var(--soft-pink); }
            33% { background-color: rgba(255,183,197, 0.3); }
            66% { background-color: rgba(255,183,197, 0.1); }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-5xl mx-auto">
        <!-- æ¨™é¡Œå€ -->
        <header class="mb-10 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-pink-200 pink-glow mb-3">Sales Diary Plus</h1>
            <p class="text-pink-300 opacity-60 uppercase tracking-[0.3em] text-xs font-bold">æ•¸æ“šç›£æ§èˆ‡ AI åˆ†æä¸­å¿ƒ</p>
        </header>

        <!-- æ•¸æ“šå¡ç‰‡ -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="card rounded-3xl p-5 text-center">
                <p class="text-pink-200 opacity-70 text-[10px] font-black mb-2 tracking-widest uppercase">ç¬¬ä¸€ç›®æ¨™ (åŸºç¤)</p>
                <div class="flex items-center justify-center gap-1">
                    <span class="text-lg font-light text-pink-300">$</span>
                    <input type="number" id="targetInput" class="bg-transparent text-xl font-bold text-white w-28 text-center border-b border-pink-200 border-opacity-20 focus:border-opacity-100 transition-all">
                </div>
            </div>
            <div class="card rounded-3xl p-5 text-center">
                <p class="text-pink-200 opacity-70 text-[10px] font-black mb-2 tracking-widest uppercase">ç¬¬äºŒç›®æ¨™ (æŒ‘æˆ°)</p>
                <div class="flex items-center justify-center gap-1">
                    <span class="text-lg font-light text-pink-300">$</span>
                    <input type="number" id="target2Input" class="bg-transparent text-xl font-bold text-white w-28 text-center border-b border-pink-200 border-opacity-20 focus:border-opacity-100 transition-all">
                </div>
            </div>
            <div class="card rounded-3xl p-5 text-center border-pink-200 border-opacity-30">
                <p class="text-pink-200 opacity-70 text-[10px] font-black mb-2 tracking-widest uppercase">ç›®å‰ç¸½ç´¯ç©</p>
                <p class="text-2xl font-black text-white" id="totalDisplay">$0</p>
            </div>
            <div class="card rounded-3xl p-5 text-center">
                <p class="text-pink-200 opacity-70 text-[10px] font-black mb-2 tracking-widest uppercase">å‰©é¤˜å·®é¡</p>
                <p class="text-xl font-bold text-pink-200" id="gapDisplay">$0</p>
            </div>
        </div>

        <!-- AI åˆ†æå€ -->
        <div class="card rounded-3xl p-6 mb-12 border-pink-400/30 bg-gradient-to-br from-pink-900/20 to-transparent">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-3">
                    <span class="p-2 bg-pink-400/20 rounded-lg text-xl">âœ¨</span>
                    <div>
                        <h3 class="font-bold text-pink-200">Gemini AI ç‡Ÿé‹å»ºè­°</h3>
                        <p class="text-xs text-pink-300 opacity-60">AI å°‡ç‚ºæ‚¨åˆ†ææ•¸æ“šä¸¦æä¾›èªéŸ³å ±å‘Š</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button id="aiVoiceBtn" onclick="runAI(true)" class="bg-white/5 hover:bg-white/10 border border-pink-200/20 text-pink-200 px-4 py-2 rounded-xl text-xs font-bold transition-all">
                        ğŸ”Š èªéŸ³å ±å‘Š
                    </button>
                    <button id="aiAnalysisBtn" onclick="runAI(false)" class="bg-pink-300 hover:bg-pink-200 text-gray-900 px-6 py-2 rounded-xl text-xs font-bold transition-all shadow-lg shadow-pink-500/20">
                        âœ¨ æ™ºæ…§åˆ†æ
                    </button>
                </div>
            </div>
            <div id="aiResponseArea" class="mt-4 hidden text-sm text-pink-100/90 leading-relaxed bg-black/20 p-4 rounded-2xl border border-white/5">
                <div id="aiContent"></div>
                <div id="aiLoader" class="py-2 hidden"><span class="typing-loader"></span></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- è¼¸å…¥ç´€éŒ„ -->
            <section>
                <h2 class="text-lg font-bold mb-5 flex items-center gap-3">
                    <span class="w-1.5 h-5 bg-pink-300 rounded-full shadow-[0_0_10px_#ffb7c5]"></span>
                    æ–°å¢ç‡Ÿæ¥­ç´€éŒ„
                </h2>
                <div class="card rounded-3xl p-8">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-pink-200 opacity-60 text-[10px] font-black uppercase tracking-widest mb-2">æ—¥æœŸ</label>
                            <input type="date" id="dateInput" class="w-full bg-white bg-opacity-5 border border-white border-opacity-10 rounded-xl px-4 py-3 text-white">
                        </div>
                        <div>
                            <label class="block text-pink-200 opacity-60 text-[10px] font-black uppercase tracking-widest mb-2">é‡‘é¡</label>
                            <input type="number" id="amountInput" placeholder="0.00" class="w-full bg-white bg-opacity-5 border border-white border-opacity-10 rounded-xl px-4 py-3 text-white">
                        </div>
                        <button onclick="addRecord()" class="w-full bg-pink-300 hover:bg-pink-200 text-gray-900 font-black py-4 rounded-xl transition-all tracking-[0.2em] text-sm">
                            å„²å­˜æ•¸æ“š
                        </button>
                    </div>
                </div>
            </section>

            <!-- æ­·å²ç´€éŒ„ -->
            <section>
                <h2 class="text-lg font-bold mb-5 flex items-center gap-3">
                    <span class="w-1.5 h-5 bg-pink-300 rounded-full shadow-[0_0_10px_#ffb7c5]"></span>
                    æ•¸æ“šæ­·å²
                </h2>
                <div class="card rounded-3xl p-4 min-h-[350px]">
                    <div class="overflow-y-auto max-h-[380px]">
                        <table class="w-full text-left">
                            <thead class="text-pink-200 opacity-40 text-[10px] font-black uppercase border-b border-white border-opacity-5">
                                <tr>
                                    <th class="pb-3 pl-2">æ—¥æœŸ</th>
                                    <th class="pb-3">é‡‘é¡</th>
                                    <th class="pb-3 text-right pr-2">å‹•ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="recordTable" class="text-sm"></tbody>
                        </table>
                        <div id="emptyState" class="py-20 text-center text-pink-200 opacity-20 italic text-sm">
                            ç›®å‰å°šç„¡ç´€éŒ„
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-4">
                    <button onclick="clearAll()" class="text-[10px] font-bold text-pink-200 opacity-30 hover:opacity-100 tracking-widest uppercase">
                        æ¸…ç©ºæ‰€æœ‰è³‡æ–™
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        let salesData = JSON.parse(localStorage.getItem('salesData')) || [];
        let targetAmount = localStorage.getItem('salesTarget') || 1000000;
        let targetAmount2 = localStorage.getItem('salesTarget2') || 2000000;

        document.getElementById('dateInput').valueAsDate = new Date();
        document.getElementById('targetInput').value = targetAmount;
        document.getElementById('target2Input').value = targetAmount2;

        function updateUI() {
            const total = salesData.reduce((sum, item) => sum + item.amount, 0);
            const gap = Math.max(0, targetAmount2 - total);

            document.getElementById('totalDisplay').textContent = `$${total.toLocaleString()}`;
            document.getElementById('gapDisplay').textContent = `$${gap.toLocaleString()}`;

            const table = document.getElementById('recordTable');
            const emptyState = document.getElementById('emptyState');
            
            if (salesData.length === 0) {
                emptyState.style.display = 'block';
                table.innerHTML = '';
            } else {
                emptyState.style.display = 'none';
                table.innerHTML = salesData
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .map((item, index) => `
                        <tr class="border-b border-white border-opacity-5 hover:bg-white/5 transition-all">
                            <td class="py-4 pl-2 text-white opacity-80">${item.date}</td>
                            <td class="py-4 font-bold text-pink-200">$${item.amount.toLocaleString()}</td>
                            <td class="py-4 text-right pr-2">
                                <button onclick="deleteRecord(${index})" class="text-pink-200 opacity-30 hover:opacity-100">âœ•</button>
                            </td>
                        </tr>
                    `).join('');
            }

            localStorage.setItem('salesData', JSON.stringify(salesData));
            localStorage.setItem('salesTarget', targetAmount);
            localStorage.setItem('salesTarget2', targetAmount2);
        }

        async function runAI(isVoice) {
            const total = salesData.reduce((sum, item) => sum + item.amount, 0);
            const responseArea = document.getElementById('aiResponseArea');
            const contentArea = document.getElementById('aiContent');
            const loader = document.getElementById('aiLoader');

            responseArea.classList.remove('hidden');
            contentArea.textContent = "";
            loader.classList.remove('hidden');

            const prompt = `ç›®å‰çš„ç‡Ÿæ¥­é¡ç¸½é¡æ˜¯ $${total} å…ƒï¼Œå…±æœ‰ ${salesData.length} ç­†ç´€éŒ„ã€‚ç›®æ¨™æ˜¯ $${targetAmount2} å…ƒã€‚
                ${isVoice ? 'è«‹ç”¨å¤§ç´„ 80 å­—ç¹é«”ä¸­æ–‡å¯«ä¸€æ®µé¼“å‹µè€é—†çš„è©±ã€‚' : 'è«‹ç”¨ç¹é«”ä¸­æ–‡æä¾› 3 å€‹æé«˜ç‡Ÿæ¥­é¡çš„ç°¡çŸ­å»ºè­°ã€‚'}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "ç„¡æ³•å–å¾—å»ºè­°ã€‚";
                
                loader.classList.add('hidden');
                contentArea.textContent = text;
                
                if (isVoice) playVoice(text);
            } catch (error) {
                loader.classList.add('hidden');
                contentArea.textContent = "AI é€£çµå¤±æ•—ã€‚";
            }
        }

        async function playVoice(text) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `ç”¨è¦ªåˆ‡çš„èªæ°£èªªï¼š${text}` }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } }
                        },
                        model: "gemini-2.5-flash-preview-tts"
                    })
                });

                const result = await response.json();
                const base64Data = result.candidates[0].content.parts[0].inlineData.data;
                const audioBlob = pcmToWav(base64Data, 24000);
                const audioUrl = URL.createObjectURL(audioBlob);
                new Audio(audioUrl).play();
            } catch (err) { console.error("èªéŸ³éŒ¯èª¤", err); }
        }

        function pcmToWav(base64, sampleRate) {
            const buffer = Uint8Array.from(atob(base64), c => c.charCodeAt(0)).buffer;
            const pcmData = new Int16Array(buffer);
            const wavBuffer = new ArrayBuffer(44 + pcmData.length * 2);
            const view = new DataView(wavBuffer);
            const writeString = (offset, s) => { for (let i = 0; i < s.length; i++) view.setUint8(offset + i, s.charCodeAt(i)); };
            writeString(0, 'RIFF');
            view.setUint32(4, 32 + pcmData.length * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, pcmData.length * 2, true);
            for (let i = 0; i < pcmData.length; i++) view.setInt16(44 + i * 2, pcmData[i], true);
            return new Blob([wavBuffer], { type: 'audio/wav' });
        }

        function addRecord() {
            const date = document.getElementById('dateInput').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            if (!date || isNaN(amount)) return;
            salesData.push({ date, amount });
            document.getElementById('amountInput').value = '';
            updateUI();
        }

        function deleteRecord(index) {
            salesData.splice(index, 1);
            updateUI();
        }

        function clearAll() {
            if (confirm('ç¢ºå®šæ¸…ç©ºå—ï¼Ÿ')) {
                salesData = [];
                updateUI();
            }
        }

        document.getElementById('targetInput').oninput = (e) => { targetAmount = e.target.value; updateUI(); };
        document.getElementById('target2Input').oninput = (e) => { targetAmount2 = e.target.value; updateUI(); };

        updateUI();
    </script>
</body>
</html>
